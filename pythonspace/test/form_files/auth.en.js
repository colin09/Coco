"use strict";window.stringify=window.JSON?JSON.stringify:function(t){if("string"==typeof t)return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"';if("number"==typeof t)return t.toString();if(null==t)return"null";if(void 0==t)return"undefined";if(void 0!=t.length)return"["+$.map(t,stringify).join(",")+"]";var e="{";for(var a in t)e=e+stringify(a)+":"+stringify(t[a])+",";return e.length>1&&(e=e.substr(0,e.length-1)),e+"}"};var auth={"is_signup_page":null,"is_login_page":null,"is_add_login_page":null,"is_password_page":null,"needs_captcha":null,"using_universal_ui":!1,"facebook_app_id":void 0,"facebook_login_params":{"scope":"email"},"localKey":"signup-prefs","prefs":{},"provider_url":null,"getPrefs":function(){if(window.localStorage){var t;try{t=window.localStorage.getItem(this.localKey)}catch(e){}t&&(this.prefs=$.parseJSON(t))}return this.prefs},"setPref":function(t,e){if(window.localStorage){this.prefs[t]=e;try{window.localStorage.setItem(this.localKey,stringify(this.prefs))}catch(a){}}},"getSsrc":function(t){var e=$('#login-form input[name="ssrc"]'),a=void 0;return e&&1===e.length&&(a=e.val()),a||(a=t),a},"init":function(t,e,a,n,o){auth.is_signup_page=t,auth.is_login_page=e,auth.is_add_login_page=a,auth.is_password_page=n,auth.needs_captcha=o;var i=[],s=[],r=[],u=[],c=[],p=null,l=null,f=null,h=null,d=function(t,e,a){if(!StackExchange.options.isMobile)return StackExchange.helpers.showMessage(t,e,a);if(0===t.next(".form-error").length){var n=$('<div class="form-error">').append($('<div class="message-text">').html(e));return t.after(n),n}};if($("#login-form").submit(this.submitx),$("#openid-buttons").on("click",".major-provider",function(t){auth.is_login_page&&StackExchange.using("gps",function(){StackExchange.gps.track("login.start",{},!0)}),auth.is_signup_page&&StackExchange.using("gps",function(){StackExchange.gps.track("signup.start",{"openid_provider":$(this).data("provider"),"location":auth.getSsrc("signup_page")},!0)}),$(this).data("provider")&&auth.signin($(this),t)}),$(".major-provider").on("click",'.large-username input[type="button"]',function(t){var e=$(t.target).parent().find('input[name="username-large"]').val();$("#login-form").find("#openid_username").val(e),$("#login-form").submit()}),$("#more-options-link").on("click",function(){auth.expandExtraProviders(!0),$("#login-form #submit-button").hide(),$(this).hide()}),$(".custom-login.needs-username").click(function(){auth.removeAllErrors(),$(".custom-login").hide(),$(".or-container,#login-form").hide(),$(".login-username-prompt").show()}),$(".return-to-form-link").click(function(){auth.removeAllErrors(),$(".login-username-prompt").hide(),$(".custom-login").show(),$(".or-container,#login-form").show()}),$(".login-username-prompt").on("click",'.controls input[type="button"]',function(t){var e=$(t.target).parent().prev().find('input[name="username-large"]').val();$("#login-form").find("#openid_username").val(e),$("#login-form").submit()}),auth.is_signup_page||auth.is_password_page){var g=null,m=null,v=$('input[name="password"]'),b=function(){if(0===v.val().length){var t=function(t){return t.pStart+"Password must contain at least eight characters, including:"+t.pEnd+" "+t.listStart+" "+t.itemStart+" letters "+t.itemEnd+" "+t.itemStart+" numbers "+t.itemEnd+" "+t.listEnd}({"pStart":"<p>","pEnd":"</p>","listStart":"<ul>","listEnd":"</ul>","itemStart":"<li>","itemEnd":"</li>"});I(s,{"id":"pw-requirements","index":-1,"attachTo":v,"message":t})}else O(s,"pw-requirements"),C(!0);for(var e=null,a=0;a<s.length;a++)if(e){var n=e.index,o=s[a].index;n>o&&(e=s[a])}else e=s[a];e?g&&m==e.attachTo?g.find(".message-text").html(e.message):(g&&(g.remove(),m=null),m=e.attachTo,g=d(m,e.message,{"position":{"my":"left top","at":"right center"},"css":{"width":"120px;","color":"#fff"},"closeOthers":!1,"dismissable":!1,"type":"info"}),e.popup&&e.popup.fadeOutAndRemove()):g&&(g.remove(),g=null,m=null)};$('input[name="password"]').on("keyup focus paste",b),$('input[name="submit-button"]').click(function(){g&&(g.remove(),g=null,m=null)})}var _=$('<div class="caps-lock-warning"></div>').text("Caps lock is on"),k=$("a#forgot-pw"),w=$('input[name="password"]'),x=!1;w.keypress(function(t){var e=String.fromCharCode(t.which),a=/[a-z]/i.test(e);if(a){var n=e==e.toUpperCase();x=n&&!t.shiftKey}var o=document.msCapsLockWarningOff===!1,i=o;x&&!i?k.length>0?k.after(_):w.after(_):_.remove()}),w.blur(function(){_.remove()}),this.prefs=auth.getPrefs(),this.prefs.provider&&(this.signin(this.prefs.provider),this.prefs.openid?(this.prefs.username&&$("#openid_username").val(this.prefs.username),$("#openid_identifier").val(this.prefs.openid)):this.prefs.oauth_server&&($("#oauth_version").val(this.prefs.oauth_version),$("#oauth_server").val(this.prefs.oauth_server)));var y=!1,E=!1;$("#login-form input").blur(function(t){auth.is_signup_page&&(""==$(t.target).val()||y||(StackExchange.gps.track("signup.start",{"openid_provider":"Stack Exchange","location":auth.getSsrc("signup_page")},!0),y=!0)),auth.is_login_page&&(""==$(t.target).val()||E||(StackExchange.gps.track("login.start",{},!0),E=!0))}),$("#login-form input[type='text'], #login-form input[type='password'], #login-form input[type='email']").keypress(function(t){return 13===t.which?($("#submit-button").is(":hidden")||auth.is_add_login_page?$("#login-form").submit():$("#login-form input[name='submit-button']").click(),t.preventDefault(),!1):void 0}),$("#formContainer .login-username-prompt input[name='username-large']").keypress(function(t){13===t.which&&$(t.target).parent().parent().find('input[type="button"]').click()});var S=function(t,e){if(t.length>0){if(null!=e){for(var a=!0,n=0;n<t.length;n++)if(t[n].message==e.message){a=!1;break}t[0].changed=a}return t[0]}return null!=e&&e.popup&&e.popup.fadeOutAndRemove(),null},T=function(t){null!=t&&(t.popup||(t.popup=d(t.attachTo,t.message,{"position":{"my":"left top","at":"right center"},"css":{"width":"120px;","color":"#fff"},"closeOthers":!1,"dismissable":!1})),t.changed&&(c.push(t.popup),t.popup=d(t.attachTo,t.message,{"position":{"my":"left top","at":"right center"},"css":{"width":"120px;","color":"#fff"},"closeOthers":!1,"dismissable":!1})))},P=function(){for(var t=0;t<c.length;t++)c[t]&&c[t].fadeOutAndRemove();c=[]},q=function(){T(p),T(l),T(h),T(f),setTimeout(P,StackExchange.options.isMobile?2e3:200)},O=function(t,e){for(var a="all"===e,n=0;n<t.length&&(t[n].id!=e&&!a||(t[n].popup&&c.push(t[n].popup),t.splice(n,1),a));n++);};this.removeAllErrors=function(){O(i,"all"),O(s,"all"),O(r,"all"),O(u,"all"),StackExchange.helpers.removeMessages(),StackExchange.options.isMobile&&$(".form-error").remove()};var I=function(t,e){for(var a=!1,n=0;n<t.length;n++)if(t[n].id==e.id){e.changed=t[n].message==e.message,t[n].message=e.message,a=!0;break}a||(e.changed=!0,e.index>=t.length?t.push(e):t.splice(e.index,0,e))},A=function(t,e){var a=15,n=8,o=t.val(),i=/[a-z]/.test(o),r=/[A-Z]/.test(o),u=/\d/.test(o),c=/(_|[^\w\d])/.test(o),p=0;if(i&&p++,r&&p++,u&&p++,c&&p++,2===p&&o.length>=a)return O(s,"pw-weak"),O(s,"pw-short"),void 0;var l=$("<span><p>"+function(t){return"Please add one of the following things to make your password stronger:"+t.pEnd+" "+t.listStart+" "+t.char+" letters "+t.itemEnd+" "+t.num+" numbers "+t.itemEnd+" "+t.listEnd}({"pEnd":"</p>","listStart":"<ul>","listEnd":"</ul>","itemEnd":"</li>","char":'<li id="ch">',"num":'<li id="num">'})+"</span>");(i||r)&&u?O(e,"pw-weak"):3>p?((i||r)&&l.find("#ch").remove(),u&&l.find("#num").remove(),I(e,{"id":"pw-weak","index":1,"attachTo":t,"message":l})):O(e,"pw-weak");var f=t.val().length;if(n>f){var h=n-f;I(e,{"id":"pw-short","index":2,"attachTo":t,"message":function(t){return 1==t.remaining?"Must contain at least "+t.remaining+" more character.":"Must contain at least "+t.remaining+" more characters."}({"remaining":h})})}else O(e,"pw-short")},C=function(t){var e=$("input[name = 'password']"),a=0===$.trim(e.val()).length;a&&!t?I(s,{"id":"pw-empty","index":0,"attachTo":e,"message":"Password cannot be empty."}):O(s,"pw-empty"),(auth.is_signup_page||auth.is_password_page)&&A(e,s)},L=function(){var t=$("input[name='email']"),e=0===$.trim(t.val()).length;e?I(i,{"id":"em-empty","index":0,"attachTo":t,"message":"Email cannot be empty."}):O(i,"em-empty")},U=function(){var t=$("input[name = 'recaptcha_response_field']"),e=t.length>0,a=e&&0===t.val().length;a?I(u,{"id":"cp","index":0,"attachTo":t,"message":"CAPTCHA cannot be empty."}):O(u,"cp")},M=function(){var t=$.trim($("input[name='email']").val()).toUpperCase(),e=$("input[name='display-name']"),a=$.trim(e.val()).toUpperCase();t===a&&""!=t?I(r,{"id":"nm","index":0,"attachTo":e,"message":"Name and email address must be different. If you don't want to enter a name, just leave it blank.","faileType":"name_email_same"}):O(r,"nm")},X=function(){return C(),auth.is_signup_page&&(M(),U()),auth.is_password_page||L(),p=S(i,p),l=S(s,l),f=S(r,f),h=S(u,h),null==p&&null==l&&null==f&&null==h},Y=!0;$("#login-form input[name='submit-button']").click(function(){var t={"isSignup":auth.is_signup_page,"isLogin":auth.is_login_page,"isPassword":auth.is_password_page,"isAddLogin":auth.is_add_login_page,"hasCaptcha":$("#recaptcha_response_field").length>0};$("#login-form input").each(function(e,a){var n=$(a).attr("name");n&&(n=n.replace(/(\W|_)/gi,""),t[n]=$(a).val())}),$.ajax({"url":"/users/login-or-signup/validation/track","data":t,"type":"POST","complete":function(){var t=X();return Y&&($("#login-form input").blur(function(){if(X(),auth.is_signup_page){var t=$("#login-form input[name='email']"),e=$.trim(t.val());O(i,"em-ajax"),$.ajax({"type":"POST","url":"/users/signup/email/validate","data":{"email":e},"success":function(e){auth.isSeForm()&&(e.IsValid?p=null:(I(i,{"id":"em-ajax","index":1,"attachTo":t,"message":e.ErrorMessage}),p=S(i,p)))},"complete":function(){q()}})}else q()}),Y=!1),t?($("#login-form").submit(),void 0):(q(),void 0)}})}),$("#se-pw-reset input").blur(function(t){var e=X();return e||(q(),t.preventDefault()),e}),$("#se-pw-reset").submit(function(t){var e=X();return e||(q(),t.preventDefault()),e})},"isSeForm":function(){return!auth.is_add_login_page},"removeAllErrors":function(){},"toggleExtraProviders":function(t){auth.prefs.showMoreOpenIdOptions?auth.collapseExtraProviders(t):auth.expandExtraProviders(t)},"expandExtraProviders":function(t){auth.setPref("showMoreOpenIdOptions",!0),t?$("#show-more-options").show():$("#show-more-options").fadeIn()},"collapseExtraProviders":function(t){auth.setPref("showMoreOpenIdOptions",!1),t?$("#show-more-options").hide():$("#show-more-options").fadeOut()},"facebookLogin":function(t,e){$("."+e).css("cursor","wait"),auth.facebook_app_id?auth.doJsFacebookLogin():(this.setOAuthInfo(t.oauth_version,t.oauth_server),$("#login-form").submit())},"oauth2Login":function(t,e){$("."+e).css("cursor","wait"),this.setOAuthInfo(t.oauth_version,t.oauth_server),$("#login-form").submit()},"doJsFacebookLogin":function(t){window.FB.login(function(e){if(e.authResponse){var a="/users/oauth/facebook/js?accessToken="+encodeURI(e.authResponse.accessToken)+"&fkey="+encodeURI(StackExchange.options.user.fkey);t&&(a+="&returnUrl="+encodeURI(t)),window.location=a}},auth.facebook_login_params)},"signin":function(t){function e(t){var e="users_login";auth.is_signup_page&&(e="signup_page",StackExchange.using("gps",function(){StackExchange.gps.track("signup.start",{"openid_provider":t,"location":auth.getSsrc(e)},!0)})),t&&StackExchange.using("gps",function(){StackExchange.gps.track("openid.click",{"openid_provider":t,"location":e},!0)})}function a(t){var e={"name":t.data("provider")};return t.data("url")&&(e.url=t.data("url")),t.data("label")&&(e.label=t.data("label")),t.data("oauthserver")&&(e.oauth_server=t.data("oauthserver")),t.data("oauthversion")&&(e.oauth_version=t.attr("data-oauthversion")),e}var n=t.data?a(t):t;return auth.setPref("name",n.name),"stack_exchange"===n.name?(auth.setOpenIdUrl(""),e("Stack Exchange"),void 0):n?(e(n.name.replace(/_/g," ")),"facebook"===n.name?(this.facebookLogin(n,n.name),void 0):"2.0"===n.oauth_version?(this.oauth2Login(n,n.name),void 0):(this.highlight(n.name),"openid"===n.name?($("#openid_input_area").hide(),this.setOpenIdUrl(""),$("#openid_identifier").focus(),void 0):(n.label&&""!=n.label?(this.useInputBox(n),this.setPref("label",n.label),this.provider_url=n.url):(this.setPref("label",""),$("."+n.name).css("cursor","wait"),this.setOpenIdUrl(n.url),this.provider_url=null,$("#login-form").submit()),void 0))):void 0},"submitx":function(){var t=$("#openid_username").val();if(auth.setPref("username",t),auth.setPref("openid",$("#openid_identifier").val()),""==t)return!0;$("body").css("cursor","wait"),$("#openid_submit").css("cursor","wait"),$("#se-login input[type=submit]",this).attr("disabled","disabled");var e=auth.provider_url;return e&&(e=e.replace("{username}",t),auth.setPref("openid",e),auth.setOpenIdUrl(e)),auth.is_login_page&&StackExchange.using("gps",function(){StackExchange.gps.track("login.start",{},!0)}),auth.is_signup_page&&StackExchange.using("gps",function(){StackExchange.gps.track("signup.start",{"openid_provider":"Manual","location":auth.getSsrc("signup_page")},!0)}),!0},"setOpenIdUrl":function(t){$("#openid_identifier").val(t),$("#oauth_version").val(""),$("#oauth_server").val(""),auth.setPref("oauth_version",""),auth.setPref("oauth_server",""),auth.setPref("openid",t)},"setOAuthInfo":function(t,e){$("#oauth_version").val(t),$("#oauth_server").val(e),$("#openid_identifier").val(""),auth.setPref("oauth_version",t),auth.setPref("oauth_server",e),auth.setPref("openid","")},"highlight":function(t){$("#more-openid-options a.openid_highlight").removeClass("openid_highlight"),$("."+t).addClass("openid_highlight")},"useInputBox":function(t){$("#openid_provider_label").html(t.label),$("#openid_input_area").show(),$("#openid_username").val("").focus()},"useLargeInputBox":function(t){this.toggleLargeProvider(t)}};