
# gzip压缩功能设置
#开启gzip压缩输出
gzip on;
# 最小压缩文件大小
gzip_min_length 1k;
# 压缩缓冲区
gzip_buffers 4 16k;
# 压缩版本（默认1.1，前端如果是squid2.5请使用1.0）
gzip_http_version 1.0;
# 压缩等级
gzip_comp_level 6;
# 压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。
gzip_types text/html text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;
gzip_vary on;
#limit_zone crawler $binary_remote_addr 10m; #开启限制IP连接数的时候需要使用

# http_proxy 设置
client_max_body_size 10m; #允许客户端请求的最大单文件字节数
client_body_buffer_size 128k; #缓冲区代理缓冲用户端请求的最大字节数，
proxy_connect_timeout 90; #nginx跟后端服务器连接超时时间(代理连接超时)
proxy_send_timeout 90; #后端服务器数据回传时间(代理发送超时)
proxy_read_timeout 90; #连接成功后，后端服务器响应时间(代理接收超时)
proxy_buffer_size 4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小
proxy_buffers 4 32k; #proxy_buffers缓冲区，网页平均在32k以下的设置
proxy_busy_buffers_size 64k; #高负荷下缓冲大小（proxy_buffers*2）
proxy_temp_file_write_size 64k; #设定缓存文件夹大小，大于这个值，将从upstream服务器传
proxy_temp_path /usr/local/nginx/proxy_temp 1 2;

# 设定负载均衡后台服务器列表 
# upstream  backend  { 
#     #ip_hash; 
#     # upstream 的负载均衡，weight 是权重，可以根据机器配置定义权重。
#     # weigth 参数表示权值，权值越高被分配到的几率越大。
#     server   127.0.0.1:80 weight=3 max_fails=2 fail_timeout=30s ;  
#     #server   192.168.10.101:8080 weight=3 max_fails=2 fail_timeout=30s ;  
# }

# 很重要的虚拟主机配置
server {
    # 监听端口
    listen 80;
    # 域名可以有多个，用空格隔开
    server_name localhost;
    # Server Side Include，通常称为服务器端嵌入
    ssi on; 
    index index.html index.htm index.php;
    #站点目录
    root /var/www;

    charset utf-8;

    # 对 “/” 启用负载均衡+反向代理
    # location / {
    #     # 设置要代理的 uri，注意最后的 /。可以是 Unix 域套接字路径，也可以是正则表达式。
    #     proxy_pass  http://127.0.0.1;  
    #     # 设置后端服务器“Location”响应头和“Refresh”响应头的替换文本
    #     proxy_redirect off;
    #     # 允许重新定义或者添加发往后端服务器的请求头。
    #     proxy_set_header Host $host;
    #     # 获取用户的真实 IP 地址
    #     proxy_set_header X-Real-IP $remote_addr;  
    #     # 后端的Web服务器可以通过 X-Forwarded-For 获取用户真实IP，多个 nginx 反代的情况下，例如 CDN。
    #     # 参见：http://gong1208.iteye.com/blog/1559835 和 http://bbs.linuxtone.org/thread-9050-1-1.html
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
    #     
    # }

    # 静态文件，nginx自己处理，不去请求
    location  ~*/download/ {  
        root /var/www/fs;  
        
    }
    # 图片缓存时间设置
    location ~ .*.(gif|jpg|jpeg|bmp|png|ico|txt|js|css)$   
    {   
        root /var/www/wwwrooot;   
        expires 7d; 
    }
    # JS和CSS缓存时间设置
    location ~ .*.(js|css)?$ {
        expires 1h;
    }
    location /nginx_status {
        stub_status on;
        access_log off;
        allow 192.168.10.0/24;
        deny all;
    }

    location ~ ^/(WEB-INF)/ {   
        deny all;   
    }

}
